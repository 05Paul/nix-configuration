#!/usr/bin/env bash
set -xeuo pipefail

gamescopeArgs=(
    -W 2560
    -H 1440
    -f
    -e
    --expose-wayland
    --adaptive-sync # VRR support
    --hdr-enabled
    --hdr-itm-enabled
    --mangoapp # performance overlay
    --rt
    --xwayland-count 2
    --steam
)

steamArgs=(
    -pipewire-dmabuf
    -gamepadui
    -steamdeck
    -steamos3
)
mangoConfig=(
    no_display
    cpu_temp
    gpu_temp
    ram
    vram
)
mangoVars=(
    MANGOHUD=1
    MANGOHUD_CONFIG="$(IFS=,; echo "${mangoConfig[*]}")"
)

export "${mangoVars[@]}"
exec gamescope "${gamescopeArgs[@]}" -- steam "${steamArgs[@]}" > /dev/null 2>&1
